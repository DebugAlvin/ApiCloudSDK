<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/public.css"/>
    <style>
        .aui-input-row:first-child:after{
            border-top:none
        }
        .aui-input-row {
            width: 100%;
        }
    </style>
</head>
<body>
<div id="app" v-cloak>
    <div class="aui-content">
        <div class="aui-form">
            <div class="aui-input-row">
                <input type="text" class="aui-input" placeholder="收货人姓名" v-model="name"/>
            </div>
            <div class="aui-input-row">
                <input type="number" class="aui-input" placeholder="输入手机号码" v-model="mobile"/>
            </div>
            <div class="aui-input-row" id='addressView'>
                <input type="text" class="aui-input" placeholder="收货地区" v-model="pos_name" readonly="readonly"/>
            </div>
            <div class="aui-input-row">
                <input type="text" class="aui-input" placeholder="详细地址" v-model="address_info"/>
            </div>
        </div>
    </div>
    <div class="aui-content-padded">
        <div class="aui-btn aui-btn-danger aui-btn-block aui-margin-t-10" @click="update_address()">提交</div>
    </div>
</div>


<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/vue.js"></script>
</body>
</html>
<script type="text/javascript">
    var vm = new Vue({
        el: '#app',
        data: {
            id: '',
            name: '',
            mobile: '',
            pos_province: '',
            pos_city: '',
            pos_district: '',
            pos_name: '',
            address_info: '',
            token: $api.getStorage('token')
        },
        methods: {
            update_address: function () {
                if(!vm.name){
                    api.toast({
                        msg: '姓名不能为空',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return false;
                }
                if (!vm.mobile) {
                    api.toast({
                        msg: '请输入手机号码',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return false;
                }
                if (!(/^1[3|4|5|8]\d{9}$/.test(vm.mobile))) {
                    api.toast({
                        msg: '手机号码有误',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return false;
                }
                if (!vm.address_info) {
                    api.toast({
                        msg: '详细地址不能为空',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return false;
                }
                api.ajax({
                    url: update_address_url,
                    method: 'post',
                    timeout: 30,
                    dataType: 'json',
                    returnAll: false,
                    data: {
                        values: {
                            id: vm.id,
                            name: vm.name,
                            mobile: vm.mobile,
                            pos_province: vm.pos_province,
                            pos_city: vm.pos_city,
                            pos_district: vm.pos_district,
                            pos_name: vm.pos_name,
                            address_info: vm.address_info,
                            token: vm.token,
                            deviceid: api.deviceId
                        }
                    }
                }, function (ret, err) {
                    console.log(JSON.stringify(ret));
                    api.toast({
                        msg: ret.msg,
                        duration: 2000,
                        location: 'bottom'
                    });
                    if (ret.status == 1) {
                        api.sendEvent({
                            name: 'address_list_init'
                        });
                        setTimeout(function () {
                            api.closeWin({
                                name: 'address_edit_win'
                            });
                        },200);
                    }
                });
            }
        }
    });
    apiready = function () {
        var header = document.querySelector('header');
        $api.fixIos7Bar(header);
        var addressView = api.require('addressView');
        addressView.open({
            file_addr: 'widget://res/district.txt', //数据源地址
            selected_color: '#ff0000', //颜色
            pro_id: 410000, //省id
            city_id: 410100, //市id
            dir_id: 410104 //区id
        });
        $api.addEvt($api.byId("addressView"), 'click', function () {
            addressView.show({}, function (ret, err) {
                if (ret.status) {
                    vm.pos_province = ret.data[0].id;
                    vm.pos_city = ret.data[1].id;
                    vm.pos_district = ret.data[2].id;
                    vm.pos_name = ret.data[0].name+'  '+ret.data[1].name+'  '+ret.data[2].name;
                }
            });
        });
        api.ajax({
            url: update_addres_before_url,
            method: 'post',
            timeout: 30,
            dataType: 'json',
            returnAll: false,
            data: {
                values: {
                    id: api.pageParam.id,
                    token: $api.getStorage('token')
                }
            }
        }, function (ret, err) {
            if (ret) {
                vm.id = ret.data.id;
                vm.name = ret.data.name;
                vm.mobile = ret.data.mobile;
                vm.pos_province = ret.data.pos_province;
                vm.pos_city = ret.data.pos_city;
                vm.pos_district = ret.data.pos_district;
                vm.pos_name = ret.data.pos_name;
                vm.address_info = ret.data.address_info;
            } else {
                //api.alert(JSON.stringify(err));
				api.toast({
                          msg: '您当前的网络不太好，请重新试试!',
                          duration: 2000,
                          location: 'bottom'
                      });
            }
        });
    };
</script>
<!--fdf8f8ff74066873-->
<!--i27d4c116f8e8139-->
<!--g62bab3e1488681-->
<!--oa21bb6f8f982365-->
<!--ld89b6f1aabcc986-->
<!--o89146a3671be180-->
<!--a39c78405713d162-->
<!--e722bde04b60467-->
<!--n23a1c525e83d619-->
<!--mbdebc1f2bb4e679-->
<!--g9e3da1a74f85911-->
<!--ppqdfigalfflklcqpfcidijekfblneqgmhef-->
<!--dnhhldbkhbghghgkjdbceemonadoajbafeag-->
