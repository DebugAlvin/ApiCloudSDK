<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <link rel="stylesheet" type="text/css" href="../../css/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/public.css"/>
    <style>
        .aui-input-row:first-child:after{
            border-top:none
        }
        .aui-input-row {
            width: 100%;
        }

        .aui-input-row input{
              background:none;
        }



        input::-webkit-input-placeholder { /* WebKit browsers */
        color: #7b7b7b;
        }
        input:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
        color: #7b7b7b;
        }
        input::-moz-placeholder { /* Mozilla Firefox 19+ */
        color: #7b7b7b;
        }
        input:-ms-input-placeholder { /* Internet Explorer 10+ */
        color: #7b7b7b;
        }
    </style>
</head>
<body style="padding-top:50px;">
<div id="app" v-cloak>
    <div class="aui-content">
        <div style="background:none;padding:25px;" class="aui-form">
            <div style="margin-bottom:18px;" class="aui-input-row">
                <input style="border:1px solid #7b7b7b;border-radius:2px;" type="number" class="aui-input" placeholder="请输入手机号" v-model="mobile"/>
            </div>
            <div style="margin-bottom:18px;" class="aui-input-row">
                <div class="aui-col-xs-8 aui-pull-left">
                    <input style="border:1px solid #7b7b7b;border-radius:2px;"  class="aui-input" type="number" v-model="code" placeholder="输入验证码"/>
                </div>
                <div class="aui-col-xs-4 aui-pull-right" style="height: 60px;line-height: 37px;">
                    <div style="background:#d9d0d0;border:none;margin-left:10px;" class="aui-btn" tapmode v-on:click="send_message()" v-bind:class="{ 'aui-btn-danger': timeer==0 }">
                        <span v-if="timeer == 0">点击获取</span>
                        <span v-else>{{ timeer }} s</span>
                    </div>
                </div>
            </div>
            <div style="margin-bottom:18px;" class="aui-input-row">
                <input style="border:1px solid #7b7b7b;border-radius:2px;" type="password" class="aui-input" placeholder="设置登录密码" v-model="password"/>
            </div>
            <div class="aui-input-row">
                <input style="border:1px solid #7b7b7b;border-radius:2px;" type="password" class="aui-input" placeholder="再次输入登录密码" v-model="repassword"/>
            </div>
        </div>
    </div>
    <div style="padding:0px 15px 0px 15px;" class="aui-content-padded">
        <div style="background:#d9d0d0;border:none;" class="aui-btn aui-btn-danger aui-btn-block aui-margin-t-10" @click="subform()">提交</div>
    </div>
</div>
</body>
</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/vue.js"></script>
<script type="text/javascript">
    var vm = new Vue({
        el: '#app',
        data: {
            mobile: '',
            code: '',
            password: '',
            repassword: '',
            reement: '',

            timeer: 0,
            count: 60,//短信验证码发送间隔时间设置
        },
        methods: {
            //发送短信验证码
            send_message: function () {
                if(vm.timeer >0){
                    return false;
                }
                if (vm.mobile == '') {
                    alert('请输入手机号码');
                    return
                }
                if (!(/^1[3|4|5|8]\d{9}$/.test(vm.mobile))) {
                    alert('手机号码有误');
                    return
                }
                var temp_count = vm.count;
                vm.timeer = temp_count;
                var coutnnum = setInterval(function () {
                    if(vm.timeer == 0){
                        clearInterval(coutnnum);
                        return;
                    }else{
                        vm.timeer -= 1;
                    }
                },'1000');
                api.ajax({
                    url: resetPassword_sendsms_url,
                    method: 'post',
                    timeout: 30,
                    data: {
                        values: {
                            mobile: vm.mobile
                        }
                    }
                }, function (ret, err) {
                    api.toast({
                        msg: ret.msg,
                        duration: 2000,
                        location: 'bottom'
                    });
                });
            },
            subform:function () {
                var mobile = vm.mobile;
                var code = vm.code;
                var password = vm.password;
                var repassword = vm.repassword;
                var reement = vm.reement;
                if (mobile == '') {
                    api.toast({
                        msg: '请输入手机号码',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return
                }
                if (!(/^1[3|4|5|8]\d{9}$/.test(mobile))) {
                    api.toast({
                        msg: '手机号码有误',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return
                }
                if (code == '') {
                    api.toast({
                        msg: '请输入验证码',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return
                }
                if (password == '') {
                    api.toast({
                        msg: '请输入登录密码',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return
                }
                if (password.length < 6) {
                    api.toast({
                        msg: '登录不能少于6位数',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return
                }
                if (repassword == '') {
                    api.toast({
                        msg: '请再次输入登录密码',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return
                }
                if (password != repassword) {
                    api.toast({
                        msg: '两次输入密码不一致',
                        duration: 2000,
                        location: 'bottom'
                    });
                    return
                }
                api.ajax({
                    url: resetPassword_url,
                    method: 'post',
                    timeout: 30,
                    data: {
                        values: {
                            mobile: mobile,
                            smscode: code,
                            password: password
                        }
                    }
                }, function (ret, err) {
                    api.toast({
                        msg: ret.msg,
                        duration: 2000,
                        location: 'bottom'
                    });
                    if (ret.status == 1) {
                        $api.setStorage('token', ret.data.token);
                        $api.setStorage('member_info', ret.data);
                        api.closeWin({
                            name:'member_login'
                        });
                        setInterval(function () {
                            api.closeWin({
                                name: 'member_change_password'
                            });
                        },2000)
                    }
                });
            }
        },
    });
</script>
<!--neb7c85af5ea8931-->
<!--hcd757ed6df4a179-->
<!--d039abf0ba721403-->
<!--q2c59ba822e32202-->
<!--nac36e2b8e1c5514-->
<!--qf7d88340c664466-->
<!--a12c34cfea070899-->
<!--jaaa54d4eb196403-->
<!--hd994056848a7207-->
<!--q36a4e8e928bd425-->
<!--a0e020cfc35f6190-->
<!--epbdmmiiqaicldpqelqqpdpkqclhjgoiejmd-->
<!--qhckidhjdjgjmlniiajbemaidbqdhcoqfcfe-->
